<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GFA Manager â€” Administration</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- BibliothÃ¨que PDF (jsPDF + autoTable pour gÃ©nÃ©ration PDF) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script>
// â”€â”€ Ouvre le client mail avec texte prÃ©-rempli (associÃ© individuel) â”€â”€
function ouvrirMailAssocie(associe, groupement) {
  let baseUrl = location.origin + location.pathname.replace(/index\.html$/i, '');
  if(!baseUrl.endsWith('/')) baseUrl += '/';
  const lien = `${baseUrl}associe.html?token=${associe.token}`;
  const sujet = encodeURIComponent(
    `Votre accÃ¨s GFA Manager â€” ${groupement.nom}`
  );
  const corps = encodeURIComponent(
`Bonjour ${associe.prenom},

Vous Ãªtes associÃ©(e) au groupement "${groupement.nom}" (${groupement.vigneron || ''}).

Retrouvez votre espace personnel â€” informations, crÃ©dits et commandes â€” via le lien ci-dessous :

${lien}

Ce lien vous est personnel. Conservez-le prÃ©cieusement.

Cordialement`
  );
  window.location.href = `mailto:${associe.email}?subject=${sujet}&body=${corps}`;
}

// â”€â”€ Ouvre le client mail pour une campagne (associÃ© individuel) â”€â”€
function ouvrirMailCampagne(associe, groupement, annee, dateFin) {
  let baseUrl = location.origin + location.pathname.replace(/index\.html$/i, '');
  if(!baseUrl.endsWith('/')) baseUrl += '/';
  const lien  = `${baseUrl}associe.html?token=${associe.token}`;
  const ppb   = groupement.parts_pour_bouteille || 1;
  const prix  = groupement.prix_bouteille_reference || 0;
  const creds = ((associe.parts || 0) / ppb * prix).toFixed(2);
  const sujet = encodeURIComponent(
    `ğŸ· Campagne GFA ${annee} â€” Passez votre commande`
  );
  const corps = encodeURIComponent(
`Bonjour ${associe.prenom},

La campagne ${annee} est maintenant ouverte pour le groupement "${groupement.nom}".

Vos crÃ©dits disponibles : ${creds} â‚¬${dateFin ? `\nDate limite de commande : ${dateFin}` : ''}

AccÃ©dez Ã  votre espace pour passer votre commande :

${lien}

Cordialement`
  );
  window.location.href = `mailto:${associe.email}?subject=${sujet}&body=${corps}`;
}

window.MAIL = { ouvrirMailAssocie, ouvrirMailCampagne };
</script>

<!-- â•â• FIREBASE (v10 CDN) â•â• -->
<script type="module">
import { initializeApp }                    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
                                            from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, doc, getDocs, getDoc, setDoc, addDoc, updateDoc, deleteDoc, onSnapshot, query, where, orderBy }
                                            from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  âœ…  CONFIGURATION FIREBASE â€” Projet : gfa-manager-50a7f    â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey:            "AIzaSyB6MW35DPPsh59DoOEPVXml6FIvDNFgdI0",
  authDomain:        "gfa-manager-50a7f.firebaseapp.com",
  projectId:         "gfa-manager-50a7f",
  storageBucket:     "gfa-manager-50a7f.firebasestorage.app",
  messagingSenderId: "224596157977",
  appId:             "1:224596157977:web:c8d09907b8185010076c88"
};

const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

// â”€â”€ Utilitaires Firestore (existants) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function getGroupements() {
  const snap = await getDocs(collection(db, "groupements"));
  return snap.docs.map(d => ({ id: d.id, ...d.data() }));
}
async function saveGroupement(g) {
  if (g.id) {
    await updateDoc(doc(db, "groupements", g.id), g);
    return g.id;
  } else {
    const ref = await addDoc(collection(db, "groupements"), g);
    return ref.id;
  }
}
async function deleteGroupement(id) {
  await deleteDoc(doc(db, "groupements", id));
}
async function saveAssocie(groupementId, associe) {
  const ref = associe.id
    ? doc(db, "groupements", groupementId, "associes", associe.id)
    : doc(collection(db, "groupements", groupementId, "associes"));
  await setDoc(ref, associe);
  return ref.id;
}
async function deleteAssocie(groupementId, associeId) {
  await deleteDoc(doc(db, "groupements", groupementId, "associes", associeId));
}
async function getAssocies(groupementId) {
  const snap = await getDocs(collection(db, "groupements", groupementId, "associes"));
  return snap.docs.map(d => ({ id: d.id, ...d.data() }));
}

// â”€â”€ NOUVEAUX utilitaires pour vignerons et vins â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function getVignerons() {
  const snap = await getDocs(collection(db, "vignerons"));
  return snap.docs.map(d => ({ id: d.id, ...d.data() }));
}

async function saveVigneron(v) {
  if (v.id) {
    await updateDoc(doc(db, "vignerons", v.id), {
      ...v,
      updatedAt: new Date().toISOString()
    });
    return v.id;
  } else {
    const ref = await addDoc(collection(db, "vignerons"), {
      ...v,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    });
    return ref.id;
  }
}

async function getVins(vigneronId = null) {
  let q = collection(db, "vins");
  if (vigneronId) {
    q = query(q, where("vigneronId", "==", vigneronId));
  }
  // Ne pas trier dans Firestore pour Ã©viter l'index composite
  const snap = await getDocs(q);
  const vins = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  
  // Tri cÃ´tÃ© client par type puis par prix
  const typeOrder = { blanc: 1, rosÃ©: 2, rouge: 3, pÃ©tillant: 4, doux: 5 };
  vins.sort((a, b) => {
    const typeA = typeOrder[a.type] || 999;
    const typeB = typeOrder[b.type] || 999;
    if (typeA !== typeB) return typeA - typeB;
    return (a.prixUnitaire || 0) - (b.prixUnitaire || 0);
  });
  
  return vins;
}

async function saveVin(vin) {
  if (vin.id) {
    await updateDoc(doc(db, "vins", vin.id), {
      ...vin,
      updatedAt: new Date().toISOString()
    });
    return vin.id;
  } else {
    const ref = await addDoc(collection(db, "vins"), {
      ...vin,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    });
    return ref.id;
  }
}

async function deleteVin(id) {
  await deleteDoc(doc(db, "vins", id));
}

// â”€â”€ GÃ©nÃ©ration de token unique pour un associÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genToken() {
  return [...crypto.getRandomValues(new Uint8Array(24))].map(b=>b.toString(16).padStart(2,'0')).join('');
}

// â”€â”€ Exposer sur window pour les fonctions inline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.GFA = { 
  auth, db, 
  getGroupements, saveGroupement, deleteGroupement,
  saveAssocie, deleteAssocie, getAssocies, 
  getVignerons, saveVigneron,
  getVins, saveVin, deleteVin,
  genToken,
  signInWithEmailAndPassword, onAuthStateChanged, signOut 
};

// â”€â”€ Helpers DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function $(id){ return document.getElementById(id); }

// â”€â”€ Amorcer l'app dÃ¨s que Firebase est prÃªt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
onAuthStateChanged(auth, (user) => {
  document.dispatchEvent(new CustomEvent('gfa:authchange', { detail: user }));
});

// â”€â”€ Attacher les listeners une fois le DOM prÃªt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  // Listener changement d'Ã©tat auth
  document.addEventListener('gfa:authchange', e => {
    const user = e.detail;
    if(user){
      $('login-screen').style.display='none';
      $('app').style.display='block';
      if(window.loadAll) window.loadAll();
    } else {
      $('login-screen').style.display='flex';
      $('app').style.display='none';
    }
  });

  // Bouton connexion
  const btnLogin = $('l-btn');
  if(btnLogin) {
    btnLogin.addEventListener('click', async () => {
      const email=$('l-email').value.trim(), pwd=$('l-pwd').value;
      if(!email||!pwd) return;
      btnLogin.textContent='Connexionâ€¦'; btnLogin.disabled=true;
      try {
        await signInWithEmailAndPassword(auth, email, pwd);
      } catch(err){
        console.error('Erreur de connexion:', err);
        $('login-err').textContent='Email ou mot de passe incorrect.';
        $('login-err').style.display='block';
      }
      btnLogin.textContent='Se connecter'; btnLogin.disabled=false;
    });
  }

  // Enter sur le champ password
  const pwdField = $('l-pwd');
  if(pwdField) {
    pwdField.addEventListener('keydown', e=>{ if(e.key==='Enter') btnLogin?.click(); });
  }

  // Bouton dÃ©connexion
  const btnLogout = $('logout-btn');
  if(btnLogout) {
    btnLogout.addEventListener('click', () => signOut(auth));
  }

  // Navigation tabs
  document.querySelectorAll('.nav-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      if(window.STATE) {
        window.STATE.activeTab=btn.dataset.tab;
        window.STATE.ficheId=null;
      }
      if(window.render) window.render();
    });
  });
});
</script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--burg:#6B1E3C;
--burg-light:#8B2E4C;
--gold:#C9A961;
--gold-dark:#B39751;
--cream:#F8F5EF;
--dark:#2C2416;
--shadow:rgba(107,30,60,.08);
}
body{font-family:'Cormorant Garamond',serif;background:var(--cream);color:var(--dark);overflow-x:hidden}
h1,h2,h3{font-family:'Playfair Display',serif;font-weight:700;color:var(--burg)}

/* â•â•â•â•â• LOGIN SCREEN â•â•â•â•â• */
#login-screen{
display:flex;align-items:center;justify-content:center;min-height:100vh;
background:linear-gradient(135deg,var(--burg),var(--burg-light));padding:1rem
}
.login-box{
background:#fff;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.25);
max-width:420px;width:100%;padding:3rem 2.5rem
}
.login-box h1{font-size:2rem;margin-bottom:.5rem;text-align:center;color:var(--burg)}
.login-box .subtitle{text-align:center;color:#777;margin-bottom:2rem;font-size:1.05rem}
.finput{
width:100%;padding:.9rem 1rem;border:1px solid #ddd;border-radius:6px;
font-family:inherit;font-size:1rem;margin-bottom:1rem;transition:border .2s
}
.finput:focus{outline:none;border-color:var(--gold)}
#login-err{color:#c33;font-size:.9rem;margin-bottom:1rem;display:none}
.btn{
padding:.9rem 1.6rem;border:none;border-radius:6px;cursor:pointer;
font-family:'Playfair Display',serif;font-weight:600;font-size:1rem;
transition:all .2s;display:inline-block;text-align:center
}
.btn:disabled{opacity:.5;cursor:not-allowed}
.btn-gold{background:var(--gold);color:#fff}
.btn-gold:hover:not(:disabled){background:var(--gold-dark);transform:translateY(-1px)}
.btn-primary{background:var(--burg);color:#fff}
.btn-primary:hover:not(:disabled){background:var(--burg-light);transform:translateY(-1px)}
.btn-secondary{background:#e0e0e0;color:var(--dark)}
.btn-secondary:hover:not(:disabled){background:#d0d0d0}
.btn-sm{padding:.5rem 1rem;font-size:.9rem}
.btn-danger{background:#c33;color:#fff}
.btn-danger:hover:not(:disabled){background:#a22}

/* â•â•â•â•â• APP LAYOUT â•â•â•â•â• */
#app{display:none;min-height:100vh;display:flex;flex-direction:column}
#app-header{
background:linear-gradient(135deg,var(--burg),var(--burg-light));
color:#fff;padding:1.5rem 2rem;box-shadow:0 4px 12px var(--shadow)
}
#app-header h1{color:#fff;font-size:1.8rem;margin-bottom:.3rem}
#app-header .subtitle{font-size:1rem;opacity:.9}
#logout-btn{
position:absolute;top:1.5rem;right:2rem;background:rgba(255,255,255,.15);
color:#fff;border:1px solid rgba(255,255,255,.3);padding:.6rem 1.2rem;
border-radius:6px;font-size:.9rem;cursor:pointer;transition:all .2s
}
#logout-btn:hover{background:rgba(255,255,255,.25)}

.nav{
display:flex;gap:0;background:#fff;border-bottom:2px solid var(--gold);
box-shadow:0 2px 8px var(--shadow);position:sticky;top:0;z-index:100
}
.nav-btn{
flex:1;padding:1rem 1.5rem;background:none;border:none;
font-family:'Playfair Display',serif;font-weight:600;font-size:1.05rem;
color:var(--dark);cursor:pointer;transition:all .2s;position:relative
}
.nav-btn:hover{background:rgba(201,169,97,.1)}
.nav-btn.active{color:var(--burg);background:rgba(201,169,97,.15)}
.nav-btn.active::after{
content:'';position:absolute;bottom:-2px;left:0;right:0;height:2px;background:var(--burg)
}

#content{flex:1;padding:2rem;max-width:1400px;width:100%;margin:0 auto}

/* â•â•â•â•â• CARDS â•â•â•â•â• */
.card{
background:#fff;border-radius:8px;box-shadow:0 2px 12px var(--shadow);
padding:1.5rem;margin-bottom:1.5rem
}
.card-title{
font-size:1.3rem;margin-bottom:1rem;color:var(--burg);
border-bottom:2px solid rgba(201,169,97,.3);padding-bottom:.5rem
}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
.fiche-card{
background:#fff;border:1px solid rgba(107,30,60,.12);border-radius:8px;
padding:1.2rem;cursor:pointer;transition:all .2s;position:relative
}
.fiche-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px var(--shadow)}
.fiche-card h3{font-size:1.2rem;margin-bottom:.5rem}
.fiche-card p{font-size:.95rem;color:#666;margin:.3rem 0}
.badge{
display:inline-block;padding:.3rem .7rem;border-radius:4px;font-size:.85rem;
font-weight:600;margin-right:.5rem
}
.badge-actif{background:#d4edda;color:#155724}
.badge-inactif{background:#f8d7da;color:#721c24}

/* â•â•â•â•â• MODAL â•â•â•â•â• */
.modal-overlay{
position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);
z-index:1000;display:none;align-items:center;justify-content:center;padding:1rem
}
.modal-overlay.show{display:flex}
.modal-box{
background:#fff;border-radius:12px;max-width:700px;width:100%;
max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3);
position:relative
}
.mtop{
background:linear-gradient(135deg,var(--burg),var(--burg-light));
color:#fff;padding:1.5rem 2rem;border-radius:12px 12px 0 0;position:relative
}
.mtop h2{color:#fff;font-size:1.5rem;margin:0}
.mclose{
position:absolute;top:1rem;right:1rem;background:rgba(255,255,255,.2);
border:none;color:#fff;font-size:1.5rem;width:2rem;height:2rem;
border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center
}
.mclose:hover{background:rgba(255,255,255,.3)}
.mbody{padding:2rem}
.mfoot{
padding:1.5rem 2rem;border-top:1px solid #eee;display:flex;gap:1rem;justify-content:flex-end
}
.form-group{margin-bottom:1.3rem}
.form-group label{display:block;font-weight:600;margin-bottom:.4rem;color:var(--dark)}
.form-group input,
.form-group select,
.form-group textarea{
width:100%;padding:.8rem;border:1px solid #ddd;border-radius:6px;
font-family:inherit;font-size:1rem
}
.form-group textarea{resize:vertical;min-height:80px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}

/* â•â•â•â•â• TOAST â•â•â•â•â• */
.toast{
position:fixed;bottom:2rem;right:2rem;background:var(--burg);color:#fff;
padding:1rem 1.5rem;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.3);
z-index:2000;animation:slideIn .3s ease;min-width:250px
}
.toast.error{background:#c33}
@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}

/* â•â•â•â•â• NOUVEAU : Styles pour affichage vins par type â•â•â•â•â• */
.vins-by-type{margin-top:1.5rem}
.type-section{margin-bottom:2rem}
.type-header{
font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;
color:var(--burg);margin-bottom:1rem;padding-bottom:.5rem;
border-bottom:2px solid rgba(201,169,97,.3);display:flex;align-items:center;gap:.5rem
}
.type-badge{
display:inline-block;padding:.3rem .8rem;border-radius:4px;font-size:.85rem;
font-weight:600;text-transform:uppercase
}
.type-rouge{background:#fee;color:#c33}
.type-blanc{background:#ffe;color:#997}
.type-rosÃ©{background:#ffe0f0;color:#c06}
.type-pÃ©tillant{background:#e0f0ff;color:#369}
.type-doux{background:#fff0e0;color:#c90}

.vin-list-item{
display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:1rem;align-items:center;
padding:.8rem;background:rgba(248,245,239,.6);border-radius:4px;margin-bottom:.5rem
}
.vin-list-item:hover{background:rgba(248,245,239,1)}

/* â•â•â•â•â• RESPONSIVE â•â•â•â•â• */
@media(max-width:768px){
.grid{grid-template-columns:1fr}
.form-row{grid-template-columns:1fr}
.nav{flex-wrap:wrap}
.nav-btn{padding:.8rem 1rem;font-size:.95rem}
#logout-btn{position:static;margin-top:1rem;width:100%}
.vin-list-item{grid-template-columns:1fr;gap:.5rem}
}
</style>

</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!--  Ã‰CRAN DE CONNEXION                                     -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
<div class="login-box">
  <h1>ğŸ· GFA Manager</h1>
  <div class="subtitle">Administration</div>
  <div id="login-err"></div>
  <input type="email" id="l-email" class="finput" placeholder="Email" autofocus>
  <input type="password" id="l-pwd" class="finput" placeholder="Mot de passe">
  <button id="l-btn" class="btn btn-gold" style="width:100%">Se connecter</button>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!--  APPLICATION PRINCIPALE                                 -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
<header id="app-header">
  <h1>ğŸ· GFA Manager</h1>
  <div class="subtitle">Panneau d'administration</div>
  <button id="logout-btn">Se dÃ©connecter</button>
</header>

<nav class="nav">
  <button class="nav-btn active" data-tab="groupements">Groupements</button>
  <button class="nav-btn" data-tab="vignerons">Vignerons</button>
  <button class="nav-btn" data-tab="vins">Vins</button>
  <button class="nav-btn" data-tab="campagnes">Campagnes</button>
</nav>

<main id="content"></main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!--  MODAL CONTAINER                                        -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="modal-overlay" class="modal-overlay"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!--  SCRIPT PRINCIPAL                                       -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE & RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.STATE = {
  activeTab: 'groupements',
  ficheId: null,
  groupements: [],
  vignerons: [],
  vins: []
};

async function loadAll() {
  try {
    window.STATE.groupements = await window.GFA.getGroupements();
    window.STATE.vignerons = await window.GFA.getVignerons();
    window.STATE.vins = await window.GFA.getVins();
    render();
  } catch(err) {
    console.error('Erreur chargement:', err);
    toast('Erreur de chargement des donnÃ©es', true);
  }
}

window.loadAll = loadAll;

function render() {
  const content = document.getElementById('content');
  const { activeTab, ficheId } = window.STATE;
  
  if (activeTab === 'groupements') {
    content.innerHTML = renderGroupements();
  } else if (activeTab === 'vignerons') {
    content.innerHTML = renderVignerons();
  } else if (activeTab === 'vins') {
    content.innerHTML = renderVins();
  } else if (activeTab === 'campagnes') {
    content.innerHTML = renderCampagnes();
  }
  
  attachEventListeners();
}

window.render = render;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ONGLET GROUPEMENTS (code existant conservÃ©)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderGroupements() {
  const { groupements } = window.STATE;
  
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
        <h2 class="card-title" style="margin:0">Groupements (${groupements.length})</h2>
        <button class="btn btn-gold" onclick="openModalGroupement()">â• Nouveau groupement</button>
      </div>
      ${!groupements.length ? `
        <p style="color:#999;font-style:italic">Aucun groupement crÃ©Ã©. Cliquez sur "Nouveau groupement" pour commencer.</p>
      ` : `
        <div class="grid">
          ${groupements.map(g => `
            <div class="fiche-card" onclick="openFicheGroupement('${g.id}')">
              <h3>${esc(g.nom)}</h3>
              <p><strong>Vigneron:</strong> ${esc(g.vigneron||'â€”')}</p>
              <p><strong>AssociÃ©s:</strong> ${g.nb_associes || 0}</p>
              <p><strong>Parts totales:</strong> ${g.parts_totales || 0}</p>
              ${g.actif ? '<span class="badge badge-actif">Actif</span>' : '<span class="badge badge-inactif">Inactif</span>'}
            </div>
          `).join('')}
        </div>
      `}
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ONGLET VIGNERONS (NOUVEAU)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderVignerons() {
  const { vignerons } = window.STATE;
  
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
        <h2 class="card-title" style="margin:0">Vignerons (${vignerons.length})</h2>
        <button class="btn btn-gold" onclick="openModalVigneron()">â• Nouveau vigneron</button>
      </div>
      ${!vignerons.length ? `
        <p style="color:#999;font-style:italic">Aucun vigneron enregistrÃ©. Commencez par crÃ©er un vigneron pour gÃ©rer les vins.</p>
      ` : `
        <div class="grid">
          ${vignerons.map(v => `
            <div class="fiche-card" onclick="openModalVigneron('${v.id}')">
              <h3>${esc(v.domaine)}</h3>
              <p><strong>${esc(v.prenom)} ${esc(v.nom)}</strong></p>
              <p>ğŸ“ ${esc(v.region||'â€”')}</p>
              ${v.email ? `<p style="font-size:.85rem;color:#666">âœ‰ï¸ ${esc(v.email)}</p>` : ''}
            </div>
          `).join('')}
        </div>
      `}
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ONGLET VINS (NOUVEAU - avec tri par type)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderVins() {
  const { vins, vignerons } = window.STATE;
  
  // Grouper les vins par type (dÃ©jÃ  triÃ©s par Firestore: type puis prix)
  const vinsByType = {
    blanc: [],
    doux: [],
    pÃ©tillant: [],
    rosÃ©: [],
    rouge: []
  };
  
  vins.forEach(v => {
    const type = v.type || 'rouge';
    if (vinsByType[type]) {
      vinsByType[type].push(v);
    }
  });
  
  const typesLabels = {
    blanc: 'Vins Blancs',
    rosÃ©: 'Vins RosÃ©s',
    rouge: 'Vins Rouges',
    pÃ©tillant: 'Vins PÃ©tillants',
    doux: 'Vins Doux'
  };
  
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
        <h2 class="card-title" style="margin:0">Catalogue de Vins (${vins.length})</h2>
        <button class="btn btn-gold" onclick="openModalVin()">â• Nouveau vin</button>
      </div>
      
      ${!vins.length ? `
        <p style="color:#999;font-style:italic">Aucun vin dans le catalogue. CrÃ©ez vos premiers vins !</p>
      ` : `
        <div class="vins-by-type">
          ${Object.keys(vinsByType).map(type => {
            const vinsType = vinsByType[type];
            if (!vinsType.length) return '';
            
            return `
              <div class="type-section">
                <div class="type-header">
                  <span class="type-badge type-${type}">${typesLabels[type]}</span>
                  <span style="font-size:.9rem;color:#666;font-weight:400">(${vinsType.length})</span>
                </div>
                ${vinsType.map(v => {
                  const vigneron = vignerons.find(vg => vg.id === v.vigneronId);
                  return `
                    <div class="vin-list-item">
                      <div>
                        <div style="font-weight:600;color:var(--dark)">${esc(v.nom)}</div>
                        <div style="font-size:.85rem;color:#666">
                          ${vigneron ? esc(vigneron.domaine) : 'Vigneron inconnu'} 
                          ${v.millesime ? ` â€¢ ${esc(v.millesime)}` : ''}
                        </div>
                      </div>
                      <div style="font-size:.9rem;color:#666">${esc(v.appellation||'â€”')}</div>
                      <div style="font-weight:700;color:var(--burg)">${v.prixUnitaire.toFixed(2)} â‚¬</div>
                      <div style="display:flex;gap:.5rem">
                        <button class="btn btn-sm btn-secondary" onclick="openModalVin('${v.id}')">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="supprimerVin('${v.id}')">ğŸ—‘ï¸</button>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            `;
          }).join('')}
        </div>
      `}
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ONGLET CAMPAGNES (NOUVEAU)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function renderCampagnes() {
  const { groupements } = window.STATE;
  
  // Charger toutes les campagnes de tous les groupements
  const toutesLesCampagnes = [];
  
  for (const g of groupements) {
    try {
      const { collection, getDocs } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
      const campagnesSnap = await getDocs(collection(window.GFA.db, 'groupements', g.id, 'campagnes'));
      campagnesSnap.forEach(doc => {
        toutesLesCampagnes.push({
          id: doc.id,
          groupementId: g.id,
          groupementNom: g.nom,
          ...doc.data()
        });
      });
    } catch(err) {
      console.error(`Erreur chargement campagnes pour ${g.nom}:`, err);
    }
  }
  
  // Trier par annÃ©e dÃ©croissante
  toutesLesCampagnes.sort((a, b) => (b.annee || 0) - (a.annee || 0));
  
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
        <h2 class="card-title" style="margin:0">Toutes les Campagnes (${toutesLesCampagnes.length})</h2>
      </div>
      
      ${!toutesLesCampagnes.length ? `
        <p style="color:#999;font-style:italic;text-align:center;padding:2rem">
          Aucune campagne crÃ©Ã©e. CrÃ©ez une campagne depuis un groupement.
        </p>
      ` : `
        <div class="grid">
          ${toutesLesCampagnes.map(c => `
            <div class="fiche-card" style="cursor:default">
              <h3>Campagne ${c.annee || 'â€”'}</h3>
              <p><strong>Groupement:</strong> ${esc(c.groupementNom)}</p>
              <p><strong>Vins:</strong> ${(c.vinsIds || []).length}</p>
              ${c.date_fin ? `<p><strong>Date limite:</strong> ${c.date_fin}</p>` : ''}
              ${c.actif ? '<span class="badge badge-actif">Active</span>' : '<span class="badge badge-inactif">TerminÃ©e</span>'}
              <div style="margin-top:1rem;display:flex;gap:.5rem">
                <button class="btn btn-sm btn-secondary" onclick="voirDetailsCampagne('${c.groupementId}', '${c.id}')">
                  ğŸ‘ï¸ DÃ©tails
                </button>
              </div>
            </div>
          `).join('')}
        </div>
      `}
    </div>
  `;
}

async function voirDetailsCampagne(groupementId, campagneId) {
  toast('Fonction "Voir dÃ©tails campagne" - Ã€ implÃ©menter');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openModal(content) {
  const overlay = document.getElementById('modal-overlay');
  overlay.innerHTML = content;
  overlay.classList.add('show');
}

function closeModal() {
  const overlay = document.getElementById('modal-overlay');
  overlay.classList.remove('show');
  overlay.innerHTML = '';
}

// â”€â”€ Modal Vigneron (NOUVEAU) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModalVigneron(vigneronId = null) {
  const vigneron = vigneronId ? window.STATE.vignerons.find(v => v.id === vigneronId) : null;
  const isEdit = !!vigneron;
  
  const box = `
    <div class="modal-box">
      <div class="mtop">
        <h2>${isEdit ? 'Modifier le vigneron' : 'Nouveau vigneron'}</h2>
        <button class="mclose" onclick="closeModal()">Ã—</button>
      </div>
      <div class="mbody">
        <div class="form-row">
          <div class="form-group">
            <label>PrÃ©nom *</label>
            <input type="text" id="v-prenom" class="finput" value="${esc(vigneron?.prenom||'')}" required>
          </div>
          <div class="form-group">
            <label>Nom *</label>
            <input type="text" id="v-nom" class="finput" value="${esc(vigneron?.nom||'')}" required>
          </div>
        </div>
        
        <div class="form-group">
          <label>Domaine *</label>
          <input type="text" id="v-domaine" class="finput" value="${esc(vigneron?.domaine||'')}" required>
        </div>
        
        <div class="form-group">
          <label>RÃ©gion *</label>
          <input type="text" id="v-region" class="finput" value="${esc(vigneron?.region||'')}" placeholder="Ex: Bourgogne, Bordeaux..." required>
        </div>
        
        <div class="form-group">
          <label>Description</label>
          <textarea id="v-description" class="finput">${esc(vigneron?.description||'')}</textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="v-email" class="finput" value="${esc(vigneron?.email||'')}">
          </div>
          <div class="form-group">
            <label>TÃ©lÃ©phone</label>
            <input type="tel" id="v-tel" class="finput" value="${esc(vigneron?.telephone||'')}">
          </div>
        </div>
        
        <div class="form-group">
          <label>Adresse</label>
          <input type="text" id="v-adresse" class="finput" value="${esc(vigneron?.adresse||'')}">
        </div>
      </div>
      <div class="mfoot">
        <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
        ${isEdit ? `<button class="btn btn-danger" onclick="supprimerVigneron('${vigneronId}')">Supprimer</button>` : ''}
        <button class="btn btn-gold" id="save-vigneron">Enregistrer</button>
      </div>
    </div>
  `;
  
  openModal(box);
  
  document.getElementById('save-vigneron').onclick = async () => {
    const prenom = document.getElementById('v-prenom').value.trim();
    const nom = document.getElementById('v-nom').value.trim();
    const domaine = document.getElementById('v-domaine').value.trim();
    const region = document.getElementById('v-region').value.trim();
    
    if (!prenom || !nom || !domaine || !region) {
      toast('Veuillez remplir tous les champs obligatoires', true);
      return;
    }
    
    const data = {
      id: vigneronId,
      prenom,
      nom,
      domaine,
      region,
      description: document.getElementById('v-description').value.trim(),
      email: document.getElementById('v-email').value.trim(),
      telephone: document.getElementById('v-tel').value.trim(),
      adresse: document.getElementById('v-adresse').value.trim()
    };
    
    try {
      await window.GFA.saveVigneron(data);
      toast(`Vigneron ${isEdit ? 'modifiÃ©' : 'crÃ©Ã©'} avec succÃ¨s`);
      await loadAll();
      closeModal();
    } catch(err) {
      console.error(err);
      toast('Erreur lors de l\'enregistrement', true);
    }
  };
}

async function supprimerVigneron(id) {
  // VÃ©rifier si des vins utilisent ce vigneron
  const vinsVigneron = window.STATE.vins.filter(v => v.vigneronId === id);
  if (vinsVigneron.length > 0) {
    toast(`Impossible de supprimer : ${vinsVigneron.length} vin(s) associÃ©(s)`, true);
    return;
  }
  
  if (!confirm('Supprimer ce vigneron dÃ©finitivement ?')) return;
  
  try {
    await window.GFA.deleteVigneron(id);
    toast('Vigneron supprimÃ©');
    await loadAll();
    closeModal();
  } catch(err) {
    console.error(err);
    toast('Erreur lors de la suppression', true);
  }
}

// â”€â”€ Modal Vin (NOUVEAU) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModalVin(vinId = null) {
  const vin = vinId ? window.STATE.vins.find(v => v.id === vinId) : null;
  const isEdit = !!vin;
  const { vignerons } = window.STATE;
  
  if (!vignerons.length) {
    toast('CrÃ©ez d\'abord un vigneron avant d\'ajouter des vins', true);
    return;
  }
  
  const box = `
    <div class="modal-box">
      <div class="mtop">
        <h2>${isEdit ? 'Modifier le vin' : 'Nouveau vin'}</h2>
        <button class="mclose" onclick="closeModal()">Ã—</button>
      </div>
      <div class="mbody">
        <div class="form-group">
          <label>Vigneron *</label>
          <select id="vin-vigneron" class="finput" required>
            <option value="">-- SÃ©lectionnez un vigneron --</option>
            ${vignerons.map(v => `
              <option value="${v.id}" ${vin?.vigneronId === v.id ? 'selected' : ''}>
                ${esc(v.domaine)} (${esc(v.prenom)} ${esc(v.nom)})
              </option>
            `).join('')}
          </select>
        </div>
        
        <div class="form-group">
          <label>Nom du vin *</label>
          <input type="text" id="vin-nom" class="finput" value="${esc(vin?.nom||'')}" placeholder="Ex: CuvÃ©e Prestige" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Type *</label>
            <select id="vin-type" class="finput" required>
              <option value="">-- Type --</option>
              <option value="blanc" ${vin?.type === 'blanc' ? 'selected' : ''}>Blanc</option>
              <option value="rosÃ©" ${vin?.type === 'rosÃ©' ? 'selected' : ''}>RosÃ©</option>
              <option value="rouge" ${vin?.type === 'rouge' ? 'selected' : ''}>Rouge</option>
              <option value="pÃ©tillant" ${vin?.type === 'pÃ©tillant' ? 'selected' : ''}>PÃ©tillant</option>
              <option value="doux" ${vin?.type === 'doux' ? 'selected' : ''}>Doux</option>
            </select>
          </div>
          <div class="form-group">
            <label>Prix unitaire (â‚¬) *</label>
            <input type="number" id="vin-prix" class="finput" value="${vin?.prixUnitaire||''}" step="0.01" min="0" placeholder="0.00" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>MillÃ©sime</label>
            <input type="text" id="vin-millesime" class="finput" value="${esc(vin?.millesime||'')}" placeholder="Ex: 2020">
          </div>
          <div class="form-group">
            <label>Appellation</label>
            <input type="text" id="vin-appellation" class="finput" value="${esc(vin?.appellation||'')}" placeholder="Ex: Pommard">
          </div>
        </div>
        
        <div class="form-group">
          <label>Stock disponible</label>
          <input type="number" id="vin-stock" class="finput" value="${vin?.stock||''}" min="0" placeholder="Laisser vide si illimitÃ©">
        </div>
        
        <div class="form-group">
          <label>Description</label>
          <textarea id="vin-description" class="finput" placeholder="Notes de dÃ©gustation, caractÃ©ristiques...">${esc(vin?.description||'')}</textarea>
        </div>
      </div>
      <div class="mfoot">
        <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
        ${isEdit ? `<button class="btn btn-danger" onclick="supprimerVin('${vinId}')">Supprimer</button>` : ''}
        <button class="btn btn-gold" id="save-vin">Enregistrer</button>
      </div>
    </div>
  `;
  
  openModal(box);
  
  document.getElementById('save-vin').onclick = async () => {
    const vigneronId = document.getElementById('vin-vigneron').value;
    const nom = document.getElementById('vin-nom').value.trim();
    const type = document.getElementById('vin-type').value;
    const prix = parseFloat(document.getElementById('vin-prix').value);
    
    if (!vigneronId || !nom || !type || !prix || prix <= 0) {
      toast('Veuillez remplir tous les champs obligatoires', true);
      return;
    }
    
    const vigneron = vignerons.find(v => v.id === vigneronId);
    const stockVal = document.getElementById('vin-stock').value.trim();
    
    const data = {
      id: vinId,
      vigneronId,
      vigneronNom: vigneron ? vigneron.domaine : '',
      nom,
      type,
      prixUnitaire: prix,
      millesime: document.getElementById('vin-millesime').value.trim(),
      appellation: document.getElementById('vin-appellation').value.trim(),
      stock: stockVal ? parseInt(stockVal) : null,
      description: document.getElementById('vin-description').value.trim()
    };
    
    try {
      await window.GFA.saveVin(data);
      toast(`Vin ${isEdit ? 'modifiÃ©' : 'crÃ©Ã©'} avec succÃ¨s`);
      await loadAll();
      closeModal();
    } catch(err) {
      console.error(err);
      toast('Erreur lors de l\'enregistrement', true);
    }
  };
}

async function supprimerVin(id) {
  if (!confirm('Supprimer ce vin dÃ©finitivement ?')) return;
  
  try {
    await window.GFA.deleteVin(id);
    toast('Vin supprimÃ©');
    await loadAll();
  } catch(err) {
    console.error(err);
    toast('Erreur lors de la suppression', true);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FONCTIONS GROUPEMENTS (conservÃ©es de l'original)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openModalGroupement(groupementId = null) {
  const groupement = groupementId ? window.STATE.groupements.find(g => g.id === groupementId) : null;
  const isEdit = !!groupement;
  const { vignerons } = window.STATE;
  
  const box = `
    <div class="modal-box">
      <div class="mtop">
        <h2>${isEdit ? 'Modifier le groupement' : 'Nouveau groupement'}</h2>
        <button class="mclose" onclick="closeModal()">Ã—</button>
      </div>
      <div class="mbody">
        <div class="form-group">
          <label>Nom du groupement *</label>
          <input type="text" id="g-nom" class="finput" value="${esc(groupement?.nom||'')}" required>
        </div>
        
        <div class="form-group">
          <label>Vigneron</label>
          <select id="g-vigneron-select" class="finput">
            <option value="">-- SÃ©lectionnez un vigneron --</option>
            ${vignerons.map(v => `
              <option value="${v.id}" ${groupement?.vigneronId === v.id ? 'selected' : ''}>
                ${esc(v.domaine)} (${esc(v.prenom)} ${esc(v.nom)})
              </option>
            `).join('')}
            <option value="__NEW__">â• CrÃ©er un nouveau vigneron</option>
          </select>
          <input type="hidden" id="g-vigneron-id" value="${groupement?.vigneronId || ''}">
          <input type="text" id="g-vigneron-nom" class="finput" value="${esc(groupement?.vigneron||'')}" 
            placeholder="Nom du vigneron (optionnel si sÃ©lectionnÃ© ci-dessus)" style="margin-top:.5rem">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Parts totales</label>
            <input type="number" id="g-parts-tot" class="finput" value="${groupement?.parts_totales||''}" min="0">
          </div>
          <div class="form-group">
            <label>Parts pour 1 bouteille</label>
            <input type="number" id="g-ppb" class="finput" value="${groupement?.parts_pour_bouteille||1}" min="0.01" step="0.01">
          </div>
        </div>
        
        <div class="form-group">
          <label>Prix bouteille de rÃ©fÃ©rence (â‚¬)</label>
          <input type="number" id="g-prix-ref" class="finput" value="${groupement?.prix_bouteille_reference||''}" step="0.01" min="0">
        </div>
        
        <div class="form-group">
          <label>Appellation de rÃ©fÃ©rence</label>
          <input type="text" id="g-appellation" class="finput" value="${esc(groupement?.appellation||'')}">
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="g-actif" ${groupement?.actif !== false ? 'checked' : ''}>
            Groupement actif
          </label>
        </div>
      </div>
      <div class="mfoot">
        <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
        ${isEdit ? `<button class="btn btn-danger" onclick="supprimerGroupement('${groupementId}')">Supprimer</button>` : ''}
        <button class="btn btn-gold" id="save-groupement">Enregistrer</button>
      </div>
    </div>
  `;
  
  openModal(box);
  
  // Listener pour le select vigneron
  const selectVigneron = document.getElementById('g-vigneron-select');
  if (selectVigneron) {
    selectVigneron.addEventListener('change', (e) => {
      if (e.target.value === '__NEW__') {
        closeModal();
        openModalVigneron();
      } else {
        document.getElementById('g-vigneron-id').value = e.target.value;
        // Mettre Ã  jour le nom si un vigneron est sÃ©lectionnÃ©
        if (e.target.value) {
          const vigneron = vignerons.find(v => v.id === e.target.value);
          if (vigneron) {
            document.getElementById('g-vigneron-nom').value = vigneron.domaine;
          }
        }
      }
    });
  }
  
  document.getElementById('save-groupement').onclick = async () => {
    const nom = document.getElementById('g-nom').value.trim();
    if (!nom) {
      toast('Le nom du groupement est obligatoire', true);
      return;
    }
    
    const vigneronId = document.getElementById('g-vigneron-id').value;
    const vigneronNom = document.getElementById('g-vigneron-nom').value.trim();
    
    const data = {
      id: groupementId,
      nom,
      vigneronId: vigneronId || null,
      vigneron: vigneronNom,
      parts_totales: parseInt(document.getElementById('g-parts-tot').value) || 0,
      parts_pour_bouteille: parseFloat(document.getElementById('g-ppb').value) || 1,
      prix_bouteille_reference: parseFloat(document.getElementById('g-prix-ref').value) || null,
      appellation: document.getElementById('g-appellation').value.trim(),
      actif: document.getElementById('g-actif').checked
    };
    
    try {
      await window.GFA.saveGroupement(data);
      toast(`Groupement ${isEdit ? 'modifiÃ©' : 'crÃ©Ã©'} avec succÃ¨s`);
      await loadAll();
      closeModal();
    } catch(err) {
      console.error(err);
      toast('Erreur lors de l\'enregistrement', true);
    }
  };
}

async function supprimerGroupement(id) {
  if (!confirm('Supprimer ce groupement et tous ses associÃ©s dÃ©finitivement ?')) return;
  
  try {
    await window.GFA.deleteGroupement(id);
    toast('Groupement supprimÃ©');
    await loadAll();
    closeModal();
  } catch(err) {
    console.error(err);
    toast('Erreur lors de la suppression', true);
  }
}

async function openFicheGroupement(id) {
  const g = window.STATE.groupements.find(x => x.id === id);
  if (!g) return;
  
  // Charger les associÃ©s et campagnes
  const associes = await window.GFA.getAssocies(id);
  const associesActifs = associes.filter(a => a.actif !== false);
  
  const box = `
    <div class="modal-box" style="max-width:900px">
      <div class="mtop" style="position:relative">
        <h2>${esc(g.nom)}</h2>
        <button class="mclose" onclick="closeModal()">Ã—</button>
        <button class="btn btn-gold btn-sm" 
          style="position:absolute;top:1rem;right:4rem;z-index:10"
          onclick="closeModal();openNouvelleCampagne('${id}')">
          ğŸ· Nouvelle Campagne
        </button>
      </div>
      <div class="mbody">
        <!-- Informations gÃ©nÃ©rales -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem">
          <div>
            <h3 style="font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--burg);margin-bottom:1rem">
              Informations
            </h3>
            <div style="display:grid;gap:.8rem">
              <div><strong>Vigneron:</strong> ${esc(g.vigneron||'â€”')}</div>
              <div><strong>Parts totales:</strong> ${g.parts_totales || 0}</div>
              <div><strong>Parts/Bouteille:</strong> ${g.parts_pour_bouteille || 1}</div>
              <div><strong>Prix rÃ©fÃ©rence:</strong> ${g.prix_bouteille_reference ? g.prix_bouteille_reference.toFixed(2) + ' â‚¬' : 'â€”'}</div>
              <div><strong>Appellation:</strong> ${esc(g.appellation||'â€”')}</div>
              <div><strong>Statut:</strong> ${g.actif !== false ? '<span class="badge badge-actif">Actif</span>' : '<span class="badge badge-inactif">Inactif</span>'}</div>
            </div>
          </div>
          
          <div>
            <h3 style="font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--burg);margin-bottom:1rem">
              AssociÃ©s (${associes.length})
            </h3>
            <div><strong>Actifs:</strong> ${associesActifs.length}</div>
            <div><strong>Inactifs:</strong> ${associes.length - associesActifs.length}</div>
          </div>
        </div>
        
        <!-- Liste des associÃ©s -->
        <div style="margin-bottom:2rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
            <h3 style="font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--burg);margin:0">
              Liste des associÃ©s
            </h3>
            <button class="btn btn-sm btn-gold" onclick="closeModal();openModalAssocie('${id}')">â• Ajouter</button>
          </div>
          
          ${!associes.length ? `
            <p style="color:#999;font-style:italic;text-align:center;padding:1.5rem">
              Aucun associÃ© dans ce groupement
            </p>
          ` : `
            <div style="display:grid;gap:.8rem;max-height:300px;overflow-y:auto">
              ${associes.map(a => `
                <div style="display:flex;align-items:center;justify-content:space-between;padding:1rem;
                  background:rgba(248,245,239,.6);border-radius:4px;border-left:3px solid ${a.actif !== false ? 'var(--burg)' : '#ccc'}">
                  <div>
                    <div style="font-weight:600">${esc(a.prenom)} ${esc(a.nom)}</div>
                    <div style="font-size:.85rem;color:#666">${esc(a.email||'â€”')} â€¢ ${a.parts || 0} parts</div>
                  </div>
                  <div style="display:flex;gap:.5rem;align-items:center">
                    ${a.actif !== false ? '<span class="badge badge-actif">Actif</span>' : '<span class="badge badge-inactif">Inactif</span>'}
                    <button class="btn btn-sm btn-secondary" onclick="closeModal();openModalAssocie('${id}','${a.id}')">âœï¸</button>
                  </div>
                </div>
              `).join('')}
            </div>
          `}
        </div>
      </div>
      <div class="mfoot">
        <button class="btn btn-secondary" onclick="closeModal()">Fermer</button>
        <button class="btn btn-primary" onclick="closeModal();openModalGroupement('${id}')">
          âœï¸ Modifier le groupement
        </button>
      </div>
    </div>
  `;
  
  openModal(box);
}

// Fonction pour ouvrir le modal d'associÃ© (Ã  implÃ©menter si besoin)
function openModalAssocie(groupementId, associeId = null) {
  // Pour l'instant, on affiche juste un message
  // Cette fonction peut Ãªtre implÃ©mentÃ©e plus tard pour gÃ©rer les associÃ©s
  toast('Gestion des associÃ©s - Ã€ implÃ©menter selon vos besoins');
  closeModal();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NOUVELLE FONCTION: CrÃ©ation campagne par vigneron
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function openNouvelleCampagne(groupementId) {
  const g = window.STATE.groupements.find(x => x.id === groupementId);
  if (!g) return;
  
  const associes = await window.GFA.getAssocies(groupementId);
  const associesActifs = associes.filter(a => a.actif !== false);
  const anneeActuelle = new Date().getFullYear();
  const { vignerons, vins } = window.STATE;
  
  const box = `
    <div class="modal-box" style="max-width:900px">
      <div class="mtop">
        <h2>CrÃ©er une nouvelle campagne</h2>
        <button class="mclose" onclick="closeModal()">Ã—</button>
      </div>
      <div class="mbody">
        <div class="form-row">
          <div class="form-group">
            <label>AnnÃ©e</label>
            <input type="number" id="nc-annee" class="finput" value="${anneeActuelle}" min="2020" max="2099">
          </div>
          <div class="form-group">
            <label>Date limite (optionnel)</label>
            <input type="date" id="nc-fin" class="finput">
          </div>
        </div>
        
        <div class="form-group">
          <label>Prix bouteille de rÃ©fÃ©rence (â‚¬)</label>
          <input type="number" id="nc-prix-ref" class="finput" step="0.01" min="0" 
            value="${g.prix_bouteille_reference||''}" placeholder="Pour calcul des crÃ©dits">
        </div>
        
        <div style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(107,30,60,.1)">
          <div style="font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;color:var(--burg);margin-bottom:.8rem">
            SÃ©lectionner un vigneron
          </div>
          <select id="nc-vigneron" class="finput" style="margin-bottom:1rem">
            <option value="">-- Choisissez un vigneron --</option>
            ${vignerons.map(v => `
              <option value="${v.id}">${esc(v.domaine)} (${esc(v.region)})</option>
            `).join('')}
          </select>
          
          <div id="nc-vins-container"></div>
        </div>
        
        <div style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(107,30,60,.1)">
          <div style="font-family:'Playfair Display',serif;font-size:1rem;font-weight:600;color:var(--burg);margin-bottom:.8rem">
            Notifier les associÃ©s (${associesActifs.length})
          </div>
          <div id="nc-assoc-list" style="display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto">
            ${associesActifs.map(a=>`
              <div style="display:flex;align-items:center;justify-content:space-between;
                padding:.6rem 1rem;border:1px solid rgba(107,30,60,.12);border-radius:3px;
                background:rgba(248,245,239,.6)">
                <span style="font-size:.9rem"><strong>${esc(a.prenom)} ${esc(a.nom)}</strong>
                  <span style="color:#999;font-size:.82rem;margin-left:.5rem">${esc(a.email)}</span>
                </span>
                <button class="nc-mail-btn btn btn-gold btn-sm" data-aid="${a.id}">
                  âœ‰ï¸ Envoyer
                </button>
              </div>`).join('')}
            ${!associesActifs.length ? '<p style="color:#aaa;font-style:italic;font-size:.85rem">Aucun associÃ© actif.</p>' : ''}
          </div>
        </div>
      </div>
      <div class="mfoot" style="justify-content:space-between">
        <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
        <div style="display:flex;gap:.8rem">
          ${associesActifs.length > 1 ? `<button class="btn btn-primary" id="nc-all">âœ‰ï¸ Envoyer Ã  tous</button>` : ''}
          <button class="btn btn-gold" id="nc-create">CrÃ©er la campagne</button>
          <button class="btn btn-secondary" id="nc-pdf">ğŸ“„ GÃ©nÃ©rer PDF</button>
        </div>
      </div>
    </div>
  `;
  
  openModal(box);
  
  // Listener changement de vigneron
  document.getElementById('nc-vigneron').addEventListener('change', (e) => {
    const vigneronId = e.target.value;
    if (!vigneronId) {
      document.getElementById('nc-vins-container').innerHTML = '';
      return;
    }
    
    const vinsVigneron = vins.filter(v => v.vigneronId === vigneronId);
    
    if (!vinsVigneron.length) {
      document.getElementById('nc-vins-container').innerHTML = `
        <p style="color:#999;font-style:italic;margin-top:1rem">
          Ce vigneron n'a pas encore de vins. CrÃ©ez-en dans l'onglet "Vins".
        </p>
      `;
      return;
    }
    
    // Grouper par type
    const vinsByType = {
      blanc: [],
      rosÃ©: [],
      rouge: [],
      pÃ©tillant: [],
      doux: []
    };
    
    vinsVigneron.forEach(v => {
      const type = v.type || 'rouge';
      if (vinsByType[type]) {
        vinsByType[type].push(v);
      }
    });
    
    const typesLabels = {
      blanc: 'Vins Blancs',
      rosÃ©: 'Vins RosÃ©s', 
      rouge: 'Vins Rouges',
      pÃ©tillant: 'Vins PÃ©tillants',
      doux: 'Vins Doux'
    };
    
    let html = '<div style="margin-top:1rem">';
    html += '<div style="font-size:.88rem;color:#777;margin-bottom:1rem">Cochez les vins Ã  inclure dans cette campagne :</div>';
    
    Object.keys(vinsByType).forEach(type => {
      const vinsType = vinsByType[type];
      if (!vinsType.length) return;
      
      html += `
        <div style="margin-bottom:1.5rem">
          <div style="font-weight:700;color:var(--burg);margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem">
            <span class="type-badge type-${type}">${typesLabels[type]}</span>
          </div>
          <div style="display:grid;gap:.5rem">
            ${vinsType.map(v => `
              <div style="display:flex;align-items:center;gap:.8rem;padding:.6rem;background:rgba(248,245,239,.6);border-radius:4px">
                <input type="checkbox" class="vin-check" data-vin-id="${v.id}" checked style="width:18px;height:18px">
                <div style="flex:1">
                  <div style="font-weight:600">${esc(v.nom)}</div>
                  <div style="font-size:.85rem;color:#666">${esc(v.appellation||'')} ${v.millesime ? 'â€¢ '+esc(v.millesime) : ''}</div>
                </div>
                <div style="font-weight:700;color:var(--burg)">${v.prixUnitaire.toFixed(2)} â‚¬</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    });
    
    html += '</div>';
    document.getElementById('nc-vins-container').innerHTML = html;
  });
  
  // Bouton crÃ©er campagne
  document.getElementById('nc-create').onclick = async () => {
    const annee = parseInt(document.getElementById('nc-annee').value) || anneeActuelle;
    const fin = document.getElementById('nc-fin').value.trim();
    const prixRef = parseFloat(document.getElementById('nc-prix-ref').value) || null;
    const vigneronId = document.getElementById('nc-vigneron').value;
    const createBtn = document.getElementById('nc-create');
    
    if (!vigneronId) {
      toast('Veuillez sÃ©lectionner un vigneron', true);
      return;
    }
    
    // Collecter les vins sÃ©lectionnÃ©s
    const vinsSelectionnes = [];
    document.querySelectorAll('.vin-check:checked').forEach(cb => {
      const vinId = cb.dataset.vinId;
      const vin = vins.find(v => v.id === vinId);
      if (vin) {
        vinsSelectionnes.push(vinId);
      }
    });
    
    if (!vinsSelectionnes.length) {
      toast('SÃ©lectionnez au moins un vin', true);
      return;
    }
    
    createBtn.textContent = 'CrÃ©ation...';
    createBtn.disabled = true;
    
    try {
      const { db } = window.GFA;
      const { collection, doc, setDoc, getDocs, updateDoc, query, where } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
      
      // Mise Ã  jour prix de rÃ©fÃ©rence si fourni
      if (prixRef) {
        g.prix_bouteille_reference = prixRef;
        await window.GFA.saveGroupement(g);
      }
      
      // CrÃ©er la campagne
      const campagneRef = doc(collection(db, 'groupements', g.id, 'campagnes'));
      await setDoc(campagneRef, {
        annee,
        actif: true,
        date_fin: fin,
        vigneronId: vigneronId,
        vinsIds: vinsSelectionnes,
        prix_bouteille_reference: prixRef,
        cree_le: new Date().toISOString()
      });
      
      // DÃ©sactiver autres campagnes actives
      const autresCampagnes = await getDocs(
        query(collection(db, 'groupements', g.id, 'campagnes'), where('actif', '==', true))
      );
      for (const campDoc of autresCampagnes.docs) {
        if (campDoc.id !== campagneRef.id) {
          await updateDoc(doc(db, 'groupements', g.id, 'campagnes', campDoc.id), { actif: false });
        }
      }
      
      closeModal();
      toast(`Campagne ${annee} crÃ©Ã©e avec ${vinsSelectionnes.length} vin(s)`);
      setTimeout(() => location.reload(), 1500);
      
    } catch(err) {
      console.error(err);
      toast('Erreur lors de la crÃ©ation', true);
      createBtn.textContent = 'CrÃ©er la campagne';
      createBtn.disabled = false;
    }
  };
  
  // Bouton PDF (NOUVEAU)
  document.getElementById('nc-pdf').onclick = () => {
    genererPDFCampagne(g, vignerons, vins);
  };
  
  // Boutons email
  document.querySelectorAll('.nc-mail-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const a = associesActifs.find(x => x.id === btn.dataset.aid);
      if (!a) return;
      const annee = parseInt(document.getElementById('nc-annee').value) || anneeActuelle;
      const fin = document.getElementById('nc-fin').value.trim();
      window.MAIL.ouvrirMailCampagne(a, g, annee, fin);
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GÃ‰NÃ‰RATION PDF (NOUVEAU)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function genererPDFCampagne(groupement, vignerons, vins) {
  const vigneronId = document.getElementById('nc-vigneron')?.value;
  if (!vigneronId) {
    toast('SÃ©lectionnez d\'abord un vigneron', true);
    return;
  }
  
  const vigneron = vignerons.find(v => v.id === vigneronId);
  if (!vigneron) {
    toast('Vigneron introuvable', true);
    return;
  }
  
  const vinsSelectionnes = [];
  document.querySelectorAll('.vin-check:checked').forEach(cb => {
    const vin = vins.find(v => v.id === cb.dataset.vinId);
    if (vin) vinsSelectionnes.push(vin);
  });
  
  if (!vinsSelectionnes.length) {
    toast('Aucun vin sÃ©lectionnÃ©', true);
    return;
  }
  
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // En-tÃªte
  doc.setFontSize(20);
  doc.setTextColor(107, 30, 60);
  doc.text('Catalogue des Vins', 105, 20, { align: 'center' });
  
  doc.setFontSize(12);
  doc.setTextColor(0, 0, 0);
  doc.text(`Groupement: ${groupement.nom}`, 20, 35);
  doc.text(`Vigneron: ${vigneron.domaine} (${vigneron.region})`, 20, 42);
  doc.text(`Date: ${new Date().toLocaleDateString('fr-FR')}`, 20, 49);
  
  // Grouper par type
  const vinsByType = {
    blanc: [],
    rosÃ©: [],
    rouge: [],
    pÃ©tillant: [],
    doux: []
  };
  
  vinsSelectionnes.forEach(v => {
    const type = v.type || 'rouge';
    if (vinsByType[type]) {
      vinsByType[type].push(v);
    }
  });
  
  const typesLabels = {
    blanc: 'Vins Blancs',
    rosÃ©: 'Vins RosÃ©s',
    rouge: 'Vins Rouges',
    pÃ©tillant: 'Vins PÃ©tillants',
    doux: 'Vins Doux'
  };
  
  let yPos = 60;
  
  Object.keys(vinsByType).forEach(type => {
    const vinsType = vinsByType[type];
    if (!vinsType.length) return;
    
    // Section header
    doc.setFontSize(14);
    doc.setTextColor(107, 30, 60);
    doc.text(typesLabels[type], 20, yPos);
    yPos += 8;
    
    // Tableau des vins
    const tableData = vinsType.map(v => [
      v.nom,
      v.appellation || 'â€”',
      v.millesime || 'â€”',
      `${v.prixUnitaire.toFixed(2)} â‚¬`
    ]);
    
    doc.autoTable({
      startY: yPos,
      head: [['Nom', 'Appellation', 'MillÃ©sime', 'Prix']],
      body: tableData,
      theme: 'striped',
      headStyles: { fillColor: [107, 30, 60] },
      margin: { left: 20, right: 20 }
    });
    
    yPos = doc.lastAutoTable.finalY + 10;
    
    // Nouvelle page si nÃ©cessaire
    if (yPos > 250) {
      doc.addPage();
      yPos = 20;
    }
  });
  
  // Sauvegarder
  const annee = document.getElementById('nc-annee')?.value || new Date().getFullYear();
  doc.save(`Catalogue_${groupement.nom}_${annee}.pdf`);
  toast('PDF gÃ©nÃ©rÃ© avec succÃ¨s');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function toast(msg, error = false) {
  const toast = document.createElement('div');
  toast.className = 'toast' + (error ? ' error' : '');
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

function esc(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function attachEventListeners() {
  // Les event listeners inline sont gÃ©rÃ©s par onclick= dans le HTML gÃ©nÃ©rÃ©
  // Les autres sont attachÃ©s dynamiquement aprÃ¨s render
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPOSITION DES FONCTIONS POUR LES ONCLICK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.openModal = openModal;
window.closeModal = closeModal;
window.openModalGroupement = openModalGroupement;
window.supprimerGroupement = supprimerGroupement;
window.openFicheGroupement = openFicheGroupement;
window.openModalVigneron = openModalVigneron;
window.supprimerVigneron = supprimerVigneron;
window.openModalVin = openModalVin;
window.supprimerVin = supprimerVin;
window.openNouvelleCampagne = openNouvelleCampagne;
window.genererPDFCampagne = genererPDFCampagne;
window.openModalAssocie = openModalAssocie;
window.voirDetailsCampagne = voirDetailsCampagne;
window.toast = toast;
window.loadAll = loadAll;
window.render = render;

</script>

</body>
</html>
